AWSTemplateFormatVersion: '2010-09-09'
Description: Deploy Armory Spinnaker to a new VPC (qs-1rorsilkp).
Parameters:
  # TODO: Add relevant parameter entries here for the Aurora Quick Start and the Elasticache Reddis passed in from the Entrypoint templates
  # Quick Start parameters
  QSS3BucketName:
    AllowedPattern: ^[0-9a-zA-Z]+([0-9a-zA-Z-]*[0-9a-zA-Z])*$
    ConstraintDescription: Quick Start bucket name can include numbers, lowercase
      letters, uppercase letters, and hyphens (-). It cannot start or end with a hyphen
      (-).
    Default: aws-quickstart
    Description: S3 bucket name for the Quick Start assets. This string can include
      numbers, lowercase letters, uppercase letters, and hyphens (-). It cannot start
      or end with a hyphen (-).
    Type: String
  QSS3BucketRegion:
    Default: 'us-east-1'
    Description: 'The AWS Region where the Quick Start S3 bucket (QSS3BucketName) is hosted. When using your own bucket, you must specify this value.'
    Type: String
  QSS3KeyPrefix:
    AllowedPattern: ^[0-9a-zA-Z-/]*$
    ConstraintDescription: Quick Start key prefix can include numbers, lowercase letters,
      uppercase letters, hyphens (-), and forward slash (/).
    Default: quickstart-armory-spinnaker/
    Description: S3 key prefix for the Quick Start assets. Quick Start key prefix
      can include numbers, lowercase letters, uppercase letters, hyphens (-), and
      forward slash (/).
    Type: String

Conditions:
  UsingDefaultBucket: !Equals [!Ref QSS3BucketName, 'aws-quickstart']

Resources:
# TODO: this launches the Aurora MySQL stack
#  AuroraMysqlRDSStack:
#    Type: AWS::CloudFormation::Stack
#    Properties:
#      TemplateURL: !Sub
#        - 'https://${S3Bucket}.s3.${S3Region}.${AWS::URLSuffix}/${QSS3KeyPrefix}submodules/quickstart-amazon-aurora-mysql/templates/aurora_mysql.template.yaml'
#        - S3Region: !If [UsingDefaultBucket, !Ref 'AWS::Region', !Ref QSS3BucketRegion]
#          S3Bucket: !If [UsingDefaultBucket, !Sub '${QSS3BucketName}-${AWS::Region}', !Ref QSS3BucketName]
#      Parameters:
#        # TODO: See the Aurora MySQL Deployment guide for details. I have put all input parameters in as placeholders. Not all are required.
#        DBName: !Ref DBName
#        RotateDBPassword: !Ref RotateDBPassword
#        DBEngineVersion: !Ref
#        DBEngineMode: !Ref
#        DBAllocatedStorageEncrypted: !Ref
#        DBCWLogExports: !Ref
#        DBAutoMinorVersionUpgrade: !Ref
#        DBBackupRetentionPeriod: !Ref
#        DBInstanceClass: !Ref
#        DBMasterUsername: !Ref
#        DBMasterUserPassword: !Ref
#        DBPort: !Ref
#        DBAccessCIDR: !Ref
#        DBMultiAZ: !Ref
#        DBBackTrack: !Ref
#        Subnet1ID: !Ref
#        Subnet2ID: !Ref
#        VPCID: !Ref VPCStack.VPCID
#        CustomDBSecurityGroup: !Ref
#        NotificationList: !Ref
#        EnvironmentStage: !Ref
#        Application: !Ref
#        ApplicationVersion: !Ref
#        Compliance: !Ref
#        Confidentiality: !Ref
#        ProjectCostCenter:
#        ServerlessMinCapacityUnit:
#        ServerlessMaxCapacityUnit:
#        ServerlessAutoPause:
#        ServerlessSecondsUntilAutoPause:
#        # Quickstart properties
#        QSS3BucketName: !Ref QSS3BucketName
#        QSS3KeyPrefix: !Sub '${QSS3KeyPrefix}submodules/quickstart-amazon-aurora-mysql/'
#        QSS3BucketRegion: !Ref QSS3BucketRegion
  # TODO: see the CloudFormation guide here to flesh out this resource - https://docs.aws.amazon.com/AWSCloudFormation/latest/UserGuide/AWS_ElastiCache.html.
  myCacheCluster:
    Type: 'AWS::ElastiCache::CacheCluster'
    Properties:
      AZMode: cross-az
      CacheNodeType: cache.m3.medium
      Engine: redis
      NumCacheNodes: '3'
      PreferredAvailabilityZones:
        # TODO: get these from the VPC created or passed into the entrypoint templates
        - us-west-2a
        - us-west-2a
        - us-west-2b